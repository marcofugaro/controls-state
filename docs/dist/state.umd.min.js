!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ControlPanelState=t()}(this,function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t){return e(t={exports:{}},t.exports),t.exports}for(var n,r,i="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},a=function(e){return null!=e},o=Object.keys,s=function(){try{return!0}catch(e){return!1}}()?Object.keys:function(e){return o(a(e)?Object(e):e)},c=Math.max,u="function"==typeof(r=Object.assign)&&(r(n={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),n.foo+n.bar+n.trzy==="razdwatrzy")?Object.assign:function(t,n){var r,e,i,o=c(arguments.length,2);for(t=Object(function(e){if(!a(e))throw new TypeError("Cannot use null or undefined");return e}(t)),i=function(e){try{t[e]=n[e]}catch(e){r||(r=e)}},e=1;e<o;++e)n=arguments[e],s(n).forEach(i);if(void 0!==r)throw r;return t},f=Array.prototype.forEach,l=Object.create,h=function(e){var t=l(null);return f.call(arguments,function(e){a(e)&&function(e,t){var n;for(n in e)t[n]=e[n]}(Object(e),t)}),t},p=function(e){return"function"==typeof e},d="razdwatrzy",b=String.prototype.indexOf,v="function"==typeof d.contains&&!0===d.contains("dwa")&&!1===d.contains("foo")?String.prototype.contains:function(e){return-1<b.call(this,e,arguments[1])},m=t(function(e){(e.exports=function(e,t){var n,r,i,o,a;return arguments.length<2||"string"!=typeof e?(o=t,t=e,e=null):o=arguments[2],null==e?(n=i=!0,r=!1):(n=v.call(e,"c"),r=v.call(e,"e"),i=v.call(e,"w")),a={value:t,configurable:n,enumerable:r,writable:i},o?u(h(o),a):a}).gs=function(e,t,n){var r,i,o,a;return"string"!=typeof e?(o=n,n=t,t=e,e=null):o=arguments[3],null==t?t=void 0:p(t)?null==n?n=void 0:p(n)||(o=n,n=void 0):(o=t,t=n=void 0),null==e?i=!(r=!0):(r=v.call(e,"c"),i=v.call(e,"e")),a={get:t,set:n,configurable:r,enumerable:i},o?u(h(o),a):a}}),y=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e},g=t(function(e,t){var i,n,o,r,a,s,c,u=Function.prototype.apply,f=Function.prototype.call,l=Object.create,h=Object.defineProperty,p=Object.defineProperties,d=Object.prototype.hasOwnProperty,b={configurable:!0,enumerable:!1,writable:!0};n=function(e,t){var n,r;return y(t),i.call(r=this,e,n=function(){o.call(r,e,n),u.call(t,this,arguments)}),n.__eeOnceListener__=t,this},a={on:i=function(e,t){var n;return y(t),d.call(this,"__ee__")?n=this.__ee__:(n=b.value=l(null),h(this,"__ee__",b),b.value=null),n[e]?"object"==typeof n[e]?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:n,off:o=function(e,t){var n,r,i,o;if(y(t),!d.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"==typeof(r=n[e]))for(o=0;i=r[o];++o)i!==t&&i.__eeOnceListener__!==t||(2===r.length?n[e]=r[o?0:1]:r.splice(o,1));else r!==t&&r.__eeOnceListener__!==t||delete n[e];return this},emit:r=function(e){var t,n,r,i,o;if(d.call(this,"__ee__")&&(i=this.__ee__[e]))if("object"==typeof i){for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];for(i=i.slice(),t=0;r=i[t];++t)u.call(r,this,o)}else switch(arguments.length){case 1:f.call(i,this);break;case 2:f.call(i,this,arguments[1]);break;case 3:f.call(i,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),t=1;t<n;++t)o[t-1]=arguments[t];u.call(i,this,o)}}},s={on:m(i),once:m(n),off:m(o),emit:m(r)},c=p({},s),e.exports=t=function(e){return null==e?l(c):p(Object(e),s)},t.methods=a}),w=(g.methods,t(function(a){(function(){var e,t,n,r,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?a.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(a.exports=function(){return(e()-i)/1e6},t=process.hrtime,r=(e=function(){var e;return 1e9*(e=t())[0]+e[1]})(),o=1e9*process.uptime(),i=r-o):Date.now?(a.exports=function(){return Date.now()-n},n=Date.now()):(a.exports=function(){return(new Date).getTime()-n},n=(new Date).getTime())}).call(e)})),j="undefined"==typeof window?e:window,_=["moz","webkit"],O="AnimationFrame",C=j["request"+O],x=j["cancel"+O]||j["cancelRequest"+O],P=0;!C&&P<_.length;P++)C=j[_[P]+"Request"+O],x=j[_[P]+"Cancel"+O]||j[_[P]+"CancelRequest"+O];if(!C||!x){var U=0,$=0,k=[];C=function(e){if(0===k.length){var t=w(),n=Math.max(0,1e3/60-(t-U));U=n+t,setTimeout(function(){for(var e=k.slice(0),t=k.length=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(U)}catch(e){setTimeout(function(){throw e},0)}},Math.round(n))}return k.push({handle:++$,callback:e,cancelled:!1}),$},x=function(e){for(var t=0;t<k.length;t++)k[t].handle===e&&(k[t].cancelled=!0)}}var B=function(e){return C.call(j,e)};B.cancel=function(){x.apply(j,arguments)},B.polyfill=function(e){e||(e=j),e.requestAnimationFrame=C,e.cancelAnimationFrame=x};var E=z;function z(e,t,n,r){if(/\./.test(e))throw new Error("Field names may not contain a period");r=r||{};var o=t;this.parent=n||null,this.events=new g,this.type=null,this.name=e,this.batchedUpdates={},this.batchUpdatePaths=[],this.batchUpdateRaf=null,Object.defineProperties(this,{$field:{enumerable:!1,value:this},$config:{enumerable:!1,value:r},value:{get:function(){return o},set:function(e){var t={field:this,name:this.name,path:this.path,fullPath:this.path,oldValue:o,value:e},n=[],r=this;do{t.path=n.join(".");var i={};i[t.path||this.name]=Object.assign({},t),r.events.emit&&(r.events.emit("beforeChange",Object.assign({},t)),r.events.emit("beforeChanges",i)),r._batchEmit&&r._batchEmit(t.path,Object.assign({},t)),n.unshift(r.name)}while(r=r.parent);o=e}},path:{enumerable:!0,get:function(){var e=(this.parent||{}).path;return this.name?(e?e+".":"")+this.name:null}}})}z.prototype={onBeforeChange:function(e){return this.events.on("beforeChange",e),this},offBeforeChange:function(e){return this.events.off("beforeChange",e),this},onBeforeChanges:function(e){return this.events.on("beforeChanges",e),this},offBeforeChanges:function(e){return this.events.off("beforeChanges",e),this},onChange:function(e){return this.events.on("change",e),this},offChange:function(e){return this.events.off("change",e),this},onChanges:function(e){return this.events.on("changes",e),this},offChanges:function(e){return this.events.off("changes",e),this},_emitUpdate:function(){for(this.events.emit("changes",Object.assign({},this.batchedUpdates));this.batchUpdatePaths.length;)for(var e=Object.keys(this.batchedUpdates),t=0;t<e.length;t++){var n=this.batchedUpdates[e[t]],r=this.batchUpdatePaths.pop();this.events.emit("change",n),this.events.emit("change:"+r,n)}this.batchedUpdates={},this.batchUpdateRaf=null},_batchEmit:function(e,t){var n=this.batchedUpdates[t.path];n&&(t.oldValue=n.oldValue),this.batchUpdatePaths.push(e),this.batchedUpdates[e]=t,this.batchUpdateRaf||(this.batchUpdateRaf=B(this._emitUpdate.bind(this)))}};var F=M;function M(e,t,n,r){if(!(this instanceof M))return new M(e,t,n,r);E.call(this,e,t,r,n),this.type="raw"}M.prototype=Object.create(E.prototype);var R=T;function T(e,t,n,r){if(!(this instanceof T))return new T(e,t,n,r);t=void 0===t?0:t,n=n||{},E.call(this,e,t,r,n);var i=void 0===n.min?Math.min(t,0):n.min,o=void 0===n.max?Math.max(t,1):n.max,a=void 0===n.step?1:n.step;this.type="slider",this.min=i,this.max=o,this.step=a}T.prototype=Object.create(E.prototype);var A=D;function D(e,t,n,r){if(!(this instanceof D))return new D(e,t,n,r);E.call(this,e,t,r,n),this.type="button"}D.prototype=Object.create(E.prototype);var S=q;function q(e,t,n,r){if(!(this instanceof q))return new q(e,t,n,r);t=void 0===t?"":t,E.call(this,e,t,r,n),this.type="textinput"}q.prototype=Object.create(E.prototype);var L=V;function V(e,t,n,r){if(!(this instanceof V))return new V(e,t,n);t=void 0===t?"#ffffff":t,E.call(this,e,t,r,n),this.type="color"}V.prototype=Object.create(E.prototype);var H=Y;function Y(e,t,n,r){if(!(this instanceof Y))return new Y(e,t,n,r);t=void 0===t||!!t,E.call(this,e,t,r,n),this.type="checkbox"}Y.prototype=Object.create(E.prototype);var G=K,I=/(#(?:[0-9a-fA-F]{2,4}){2,4}|(#[0-9a-fA-F]{3})|(rgb|hsl)a?((-?\d+%?[,\s]+){2,3}\s*[\d.]+%?))/;function J(e){if(e&&e.type)return e.type+"field";if(t=e,i.Element&&t instanceof i.Element||i.HTMLDocument&&t instanceof i.HTMLDocument)return"rawfield";var t;if("function"==typeof e)return"button";switch(typeof e){case"string":return I.test(e)?"color":"textinput";case"number":return"number";case"boolean":return"boolean";case"raw":return"raw";case"button":return"button";case"object":return"object"}}function K(e,i,t,n){var o=this;t=t||{};var a={},s={},c={};E.call(this,e,c,n,t),this.type="section",Object.defineProperty(s,"$field",{enumerable:!1,value:this}),Object.defineProperties(c,{$field:{enumerable:!1,value:this},$path:{enumerable:!1,value:s},$displayFields:{enumerable:!1,value:a}}),Object.keys(i).forEach(function(e){var t=a[e]=function(e,t,n){switch(J(t)){case"rawfield":case"buttonfield":case"colorfield":case"textfield":case"sliderfield":case"selectfield":case"rangesliderfield":case"checkboxfield":case"sectionfield":if(t.path)throw new Error("You may only add an field to a set of controls once.");return t.$field.parent=n,t.name=e,t;case"color":return new L(e,t,{},n);case"raw":return new F(e,t,{},n);case"button":return new A(e,t,{},n);case"textinput":return new S(e,t,{},n);case"number":return new R(e,t,{},n);case"boolean":return new H(e,t,{},n);case"object":return new K(e,t,{},n);default:return null}}(e,i[e],o),n=t.$config;if("raw"===t.type){var r=void 0!==n.enumerable&&!!n.enumerable;Object.defineProperty(c,e,{enumerable:r,get:function(){return t.value}}),Object.defineProperty(s,e,{enumerable:r,get:function(){return t}})}else if("section"===t.type){r=void 0===n.enumerable||!!n.enumerable;Object.defineProperty(c,e,{enumerable:r,value:t.value}),Object.defineProperty(s,e,{enumerable:r,value:t.value.$path})}else{r=void 0===n.enumerable||!!n.enumerable;Object.defineProperty(c,e,{enumerable:r,get:function(){return t.value},set:function(e){t.value=e}}),Object.defineProperty(s,e,{enumerable:r,get:function(){return t}})}}),Object.defineProperties(c,{$onBeforeChanges:{enumerable:!1,value:this.onBeforeChanges.bind(this)},$onBeforeChange:{enumerable:!1,value:this.onBeforeChange.bind(this)},$offBeforeChanges:{enumerable:!1,value:this.offBeforeChanges.bind(this)},$offBeforeChange:{enumerable:!1,value:this.offBeforeChange.bind(this)},$onChanges:{enumerable:!1,value:this.onChanges.bind(this)},$onChange:{enumerable:!1,value:this.onChange.bind(this)},$offChanges:{enumerable:!1,value:this.offChanges.bind(this)},$offChange:{enumerable:!1,value:this.offChange.bind(this)}})}K.prototype=Object.create(E.prototype);var N=Q;function Q(e,t,n,r){if(!(this instanceof Q))return new Q(e,t,n,r);t=void 0===t?0:t,n=n||{},E.call(this,e,t,r,n);var i=void 0===n.min?Math.min(t,0):n.min,o=void 0===n.max?Math.max(t,1):n.max,a=void 0===n.step?1:n.step;this.type="rangeslider",this.min=i,this.max=o,this.step=a}Q.prototype=Object.create(E.prototype);var W=X;function X(e,t,n,r){if(!(this instanceof X))return new X(e,t,n,r);t=void 0===t?null:t,E.call(this,e,t,r,n),this.options=n.options,this.type="select"}function Z(e,t){return new G("",e,t).value}return X.prototype=Object.create(E.prototype),Z.Slider=function(e,t){return new R(null,e,t)},Z.Rangeslider=function(e,t){return new N(null,e,t)},Z.Textinput=function(e,t){return new S(null,e,t)},Z.Select=function(e,t){return new W(null,e,t)},Z.Checkbox=function(e,t){return new H(null,e,t)},Z.Color=function(e,t){return new L(null,e,t)},Z.Section=function(e,t){return new G(null,e,t)},Z.Raw=function(e,t){return new F(null,e,t)},Z});